<div class="document-details-container">
  <div class="card">
    <div class="card-header">
      <h2>Document Details</h2>
      <div class="action-buttons">
        <p-button icon="pi pi-download" (onClick)="onDownload()" 
          styleClass="p-button-outlined p-button-info" 
          tooltip="Download Document"></p-button>
        <p-button icon="pi pi-plus" (onClick)="onNewVersion()" 
          styleClass="p-button-outlined p-button-success" 
          tooltip="Upload New Version"></p-button>
        <p-button icon="pi pi-trash" (onClick)="onDelete()" 
          styleClass="p-button-outlined p-button-danger" 
          tooltip="Delete Document"></p-button>
        <p-button icon="pi pi-arrow-left" (onClick)="onBack()" 
          styleClass="p-button-outlined" 
          tooltip="Back to Documents"></p-button>
      </div>
    </div>

    <div class="card-content">
      <div *ngIf="loading" class="loading-container">
        <p-progressSpinner></p-progressSpinner>
        <p>Loading document details...</p>
      </div>

      <div *ngIf="!loading && document" class="details-content">
        <div class="detail-section">
          <h3>Document Information</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <div class="detail-label">Filename:</div>
              <div class="detail-value">{{ document.originalFilename }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">File Type:</div>
              <div class="detail-value">{{ document.fileType }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">File Size:</div>
              <div class="detail-value">{{ document.fileSize | fileSize }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Current Version:</div>
              <div class="detail-value">{{ document.currentVersion }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Upload Date:</div>
              <div class="detail-value">{{ document.uploadDate | date:'medium' }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Uploaded By:</div>
              <div class="detail-value">{{ document.uploadedBy.username }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Meeting:</div>
              <div class="detail-value">{{ document.meeting.title }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Description:</div>
              <div class="detail-value">{{ document.description }}</div>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Version History</h3>
          <p-table [value]="versions" [paginator]="true" [rows]="5" 
            [showCurrentPageReport]="true" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} versions"
            [rowsPerPageOptions]="[5,10,25]" styleClass="p-datatable-striped">
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="versionNumber">Version <p-sortIcon field="versionNumber"></p-sortIcon></th>
                <th pSortableColumn="uploadDate">Upload Date <p-sortIcon field="uploadDate"></p-sortIcon></th>
                <th pSortableColumn="uploadedBy.username">Uploaded By <p-sortIcon field="uploadedBy.username"></p-sortIcon></th>
                <th>Description</th>
                <th>Current</th>
                <th>Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-version>
              <tr>
                <td>{{ version.versionNumber }}</td>
                <td>{{ version.uploadDate | date:'medium' }}</td>
                <td>{{ version.uploadedBy.username }}</td>
                <td>{{ version.description }}</td>
                <td>
                  <p-tag *ngIf="version.isCurrentVersion" value="Current" severity="success"></p-tag>
                  <p-tag *ngIf="!version.isCurrentVersion" value="Previous" severity="info"></p-tag>
                </td>
                <td>
                  <div class="action-buttons">
                    <p-button *ngIf="!version.isCurrentVersion" icon="pi pi-history" 
                      (onClick)="onRevertVersion(version)" 
                      styleClass="p-button-rounded p-button-text p-button-warning" 
                      tooltip="Revert to this version"></p-button>
                  </div>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="6" class="text-center p-4">No version history available.</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
  </div>
</div>

<p-dialog header="Confirm Delete" [(visible)]="displayDeleteDialog" [modal]="true" [style]="{width: '450px'}">
  <div class="confirmation-content">
    <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
    <span>Are you sure you want to delete this document?</span>
  </div>
  <ng-template pTemplate="footer">
    <button pButton icon="pi pi-times" label="No" class="p-button-text" (click)="displayDeleteDialog=false"></button>
    <button pButton icon="pi pi-check" label="Yes" class="p-button-danger" (click)="confirmDelete()"></button>
  </ng-template>
</p-dialog>

<p-dialog header="Upload New Version" [(visible)]="displayVersionDialog" [modal]="true" [style]="{width: '500px'}">
  <div class="version-form">
    <div class="field">
      <label for="newVersionDescription" class="block">Description</label>
      <textarea id="newVersionDescription" pInputTextarea [(ngModel)]="newVersionDescription" rows="3" 
        class="w-full" placeholder="Enter version description"></textarea>
    </div>
    
    <div class="field">
      <label for="newVersionFile" class="block">File</label>
      <p-fileUpload #fileUpload id="newVersionFile" [customUpload]="true" (uploadHandler)="onFileSelect($event)" 
        [auto]="true" [maxFileSize]="maxFileSize" [showCancelButton]="false" 
        [showUploadButton]="false" chooseLabel="Select File" 
        [accept]="'.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt'" 
        [style]="{'width':'100%'}" [multiple]="false"></p-fileUpload>
      <small class="p-info">Maximum file size: 10MB. Supported formats: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT</small>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button pButton icon="pi pi-times" label="Cancel" class="p-button-text" (click)="displayVersionDialog=false"></button>
    <button pButton icon="pi pi-check" label="Upload" (click)="uploadNewVersion()" 
      [disabled]="!newVersionFile || !newVersionDescription"></button>
  </ng-template>
</p-dialog>

<p-toast></p-toast> 